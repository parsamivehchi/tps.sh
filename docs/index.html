<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tps.sh — Tokens Per Second LLM Benchmark</title>
<meta name="description" content="Benchmark local Ollama models against Claude API on Apple Silicon. Tokens per second, quality scoring, and cost analysis across 7 models and 147 tests.">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='28' font-size='28'>⚡</text></svg>">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #050505;
  --sidebar-bg: #000000;
  --text: #e0e0e0;
  --text-dim: #888;
  --text-dimmer: #555;
  --neon-pink: #ff00ff;
  --neon-blue: #00ffff;
  --neon-green: #00ff00;
  --neon-yellow: #ffff00;
  --card-bg: #0a0a0a;
  --border: #333;
  --border-dim: #1a1a1a;
  --scanline-opacity: 0.03;
  --overlay-white: rgba(255,255,255,0.03);
  --table-header-bg: #111;
}

[data-theme="light"] {
  --bg: #f5f5f5;
  --sidebar-bg: #fff;
  --text: #1a1a1a;
  --text-dim: #555;
  --text-dimmer: #999;
  --neon-pink: #cc00cc;
  --neon-blue: #0099aa;
  --neon-green: #008800;
  --neon-yellow: #aa8800;
  --card-bg: #fff;
  --border: #d0d0d0;
  --border-dim: #e5e5e5;
  --scanline-opacity: 0;
  --overlay-white: rgba(0,0,0,0.03);
  --table-header-bg: #e8e8e8;
}

[data-theme="neon"] {
  --bg: #0a0015;
  --sidebar-bg: #050010;
  --text: #fff;
  --text-dim: #c0c0c0;
  --text-dimmer: #808080;
  --neon-pink: #ff33ff;
  --neon-blue: #33ffff;
  --neon-green: #33ff33;
  --neon-yellow: #ffff33;
  --card-bg: #0f0020;
  --border: #6600aa;
  --border-dim: #330066;
  --scanline-opacity: 0.05;
  --overlay-white: rgba(255,255,255,0.04);
  --table-header-bg: #1a0030;
}

[data-theme="solarized"] {
  --bg: #002b36;
  --sidebar-bg: #073642;
  --text: #839496;
  --text-dim: #657b83;
  --text-dimmer: #586e75;
  --neon-pink: #d33682;
  --neon-blue: #268bd2;
  --neon-green: #859900;
  --neon-yellow: #b58900;
  --card-bg: #073642;
  --border: #586e75;
  --border-dim: #073642;
  --scanline-opacity: 0;
  --overlay-white: rgba(255,255,255,0.03);
  --table-header-bg: #0a4050;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

body {
  font-family: 'Roboto Mono', monospace;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  overflow-x: hidden;
}

/* Scanline overlay */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.15) 2px, rgba(0,0,0,0.15) 4px);
  pointer-events: none;
  z-index: 9999;
  opacity: var(--scanline-opacity);
}

/* Sidebar */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 260px;
  height: 100vh;
  background: var(--sidebar-bg);
  border-right: 1px solid var(--border-dim);
  padding: 32px 24px;
  display: flex;
  flex-direction: column;
  z-index: 100;
  overflow-y: auto;
}

.sidebar-logo {
  font-size: 1.1rem;
  font-weight: 700;
  letter-spacing: 2px;
  margin-bottom: 6px;
}

.sidebar-logo .accent { color: var(--neon-blue); }

.sidebar-sub {
  font-size: 0.75rem;
  color: var(--text-dimmer);
  letter-spacing: 1px;
  margin-bottom: 32px;
  text-transform: uppercase;
}

.sidebar-nav { display: flex; flex-direction: column; gap: 2px; }

.sidebar-nav a {
  color: var(--text-dim);
  text-decoration: none;
  font-size: 0.85rem;
  padding: 8px 12px;
  border-radius: 4px;
  transition: all 0.2s ease;
  position: relative;
}

.sidebar-nav a::before {
  content: '> ';
  color: var(--neon-pink);
  opacity: 0;
  transition: opacity 0.2s;
}

.sidebar-nav a:hover {
  color: var(--text);
  background: var(--overlay-white);
}

.sidebar-nav a:hover::before { opacity: 1; }

.sidebar-footer {
  margin-top: auto;
  padding-top: 24px;
  border-top: 1px solid var(--border-dim);
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.sidebar-footer a {
  color: var(--text-dimmer);
  text-decoration: none;
  font-size: 0.7rem;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: color 0.2s;
}

.sidebar-footer a:hover { color: var(--neon-blue); }

/* Main content */
.main {
  margin-left: 260px;
  min-height: 100vh;
}

/* Sections */
.section {
  padding: 80px 60px;
  border-bottom: 1px solid var(--border-dim);
}

.section-label {
  font-size: 0.75rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--neon-pink);
  margin-bottom: 12px;
}

.section-title {
  font-size: 1.7rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 8px;
  line-height: 1.3;
}

.section-desc {
  font-size: 0.85rem;
  color: var(--text-dim);
  max-width: 640px;
  margin-bottom: 40px;
  line-height: 1.7;
}

/* Hero */
.hero {
  padding: 120px 60px 80px;
  border-bottom: 1px solid var(--border-dim);
  position: relative;
}

.hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  border: 1px solid var(--border);
  padding: 6px 16px;
  font-size: 0.7rem;
  color: var(--text-dim);
  margin-bottom: 32px;
}

.hero-badge .status-dot {
  width: 6px;
  height: 6px;
  background: var(--neon-green);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

.hero h1 {
  font-size: clamp(2.2rem, 4.5vw, 3.5rem);
  font-weight: 700;
  line-height: 1.1;
  margin-bottom: 8px;
  letter-spacing: -1px;
}

.hero h1 .accent {
  color: var(--neon-blue);
  text-shadow: 0 0 30px rgba(0,255,255,0.4), 0 0 60px rgba(0,255,255,0.1);
}

.hero-tagline {
  font-size: 0.95rem;
  color: var(--text-dim);
  margin-bottom: 32px;
  min-height: 1.6em;
}

.hero-tagline .cursor {
  display: inline-block;
  width: 8px;
  height: 1.1em;
  background: var(--neon-green);
  margin-left: 2px;
  vertical-align: text-bottom;
  animation: blink 1s step-end infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}

.hero-meta {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.meta-badge {
  font-size: 0.7rem;
  padding: 5px 12px;
  border: 1px solid var(--border);
  color: var(--text-dim);
}

.meta-badge .val {
  color: var(--text);
  font-weight: 600;
}

.meta-badge.green .val { color: var(--neon-green); }
.meta-badge.blue .val { color: var(--neon-blue); }
.meta-badge.pink .val { color: var(--neon-pink); }
.meta-badge.yellow .val { color: var(--neon-yellow); }

/* Results table */
.results-table-wrap {
  overflow-x: auto;
  border: 1px solid var(--border);
  background: var(--card-bg);
}

.results-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
  white-space: nowrap;
}

.results-table thead th {
  background: var(--table-header-bg);
  padding: 12px 16px;
  text-align: left;
  font-size: 0.75rem;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--text-dimmer);
  font-weight: 500;
  border-bottom: 1px solid var(--border);
}

.results-table tbody td {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-dim);
  color: var(--text-dim);
}

.results-table tbody tr:hover td {
  background: var(--overlay-white);
}

.results-table .model-name {
  color: var(--text);
  font-weight: 600;
}

.results-table .best {
  font-weight: 700;
}

.bar-cell {
  position: relative;
  padding-right: 24px !important;
}

.bar-inline {
  display: inline-block;
  height: 4px;
  border-radius: 2px;
  vertical-align: middle;
  margin-right: 8px;
  min-width: 4px;
}

.quality-tag {
  display: inline-block;
  padding: 2px 8px;
  font-size: 0.7rem;
  font-weight: 600;
}

.quality-tag.high { background: rgba(0,255,0,0.1); color: var(--neon-green); }
.quality-tag.mid { background: rgba(0,255,255,0.1); color: var(--neon-blue); }
.quality-tag.low { background: rgba(255,0,255,0.1); color: var(--neon-pink); }

.crown-icon { margin-right: 4px; }

/* Card grids */
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 16px;
}

.card-grid.cols-2 { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
.card-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }

.card {
  padding: 24px;
  background: var(--card-bg);
  border: 1px solid var(--border-dim);
  transition: all 0.25s ease;
  position: relative;
}

.card:hover {
  border-color: var(--border);
  transform: translateY(-2px);
  box-shadow: 0 0 20px rgba(255,0,255,0.08);
}

.card-icon {
  font-size: 1.5rem;
  margin-bottom: 12px;
  display: block;
}

.card h3 {
  font-size: 0.95rem;
  font-weight: 700;
  margin-bottom: 6px;
  color: var(--text);
}

.card .card-desc {
  font-size: 0.83rem;
  color: var(--text-dim);
  line-height: 1.6;
}

.card .card-tag {
  display: inline-block;
  font-size: 0.6rem;
  padding: 3px 8px;
  border: 1px solid var(--border);
  color: var(--text-dimmer);
  margin-top: 12px;
}

.card-accent-top {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
}

/* Prompt category cards */
.cat-card {
  padding: 20px;
  background: var(--card-bg);
  border: 1px solid var(--border-dim);
  transition: all 0.25s ease;
}

.cat-card:hover {
  border-color: var(--border);
  transform: translateY(-1px);
}

.cat-card .cat-prefix {
  font-size: 0.65rem;
  color: var(--neon-pink);
  margin-bottom: 6px;
}

.cat-card h4 {
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 4px;
}

.cat-card .cat-count {
  font-size: 0.7rem;
  color: var(--text-dimmer);
}

/* Finding cards */
.finding-card {
  padding: 24px;
  background: var(--card-bg);
  border: 1px solid var(--border-dim);
  border-left: 2px solid var(--neon-blue);
  transition: all 0.25s ease;
}

.finding-card:hover {
  border-left-color: var(--neon-pink);
  transform: translateY(-1px);
}

.finding-card h4 {
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text);
}

.finding-card p {
  font-size: 0.83rem;
  color: var(--text-dim);
  line-height: 1.7;
}

.finding-card .finding-stat {
  display: inline-block;
  font-size: 0.7rem;
  padding: 3px 8px;
  margin-top: 10px;
  border: 1px solid var(--border);
  color: var(--neon-green);
}

/* CLI section */
.cli-block {
  background: var(--card-bg);
  border: 1px solid var(--border-dim);
  padding: 28px;
  overflow-x: auto;
}

.cli-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border-dim);
}

.cli-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

.cli-dot.red { background: #ff5f57; }
.cli-dot.yellow { background: #febc2e; }
.cli-dot.green { background: #28c840; }

.cli-title {
  font-size: 0.7rem;
  color: var(--text-dimmer);
  margin-left: 8px;
}

.cli-line {
  display: flex;
  gap: 12px;
  padding: 6px 0;
  font-size: 0.85rem;
  align-items: baseline;
}

.cli-prompt {
  color: var(--neon-green);
  user-select: none;
  flex-shrink: 0;
}

.cli-cmd {
  color: var(--neon-blue);
  white-space: nowrap;
  font-weight: 500;
}

.cli-comment {
  color: var(--text-dimmer);
  font-size: 0.7rem;
  margin-left: auto;
  white-space: nowrap;
}

/* Tech stack */
.tech-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 12px;
}

.tech-item {
  padding: 16px;
  background: var(--card-bg);
  border: 1px solid var(--border-dim);
  text-align: center;
  transition: all 0.25s ease;
}

.tech-item:hover {
  border-color: var(--border);
  transform: translateY(-1px);
}

.tech-item .tech-name {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
}

.tech-item .tech-role {
  font-size: 0.65rem;
  color: var(--text-dimmer);
}

/* Footer */
.footer {
  padding: 40px 60px;
  border-top: 1px solid var(--border-dim);
  text-align: center;
}

.footer p {
  font-size: 0.7rem;
  color: var(--text-dimmer);
  margin-bottom: 6px;
}

.footer a {
  color: var(--neon-blue);
  text-decoration: none;
  transition: color 0.2s;
}

.footer a:hover { color: var(--neon-pink); }

.footer .footer-stats {
  font-size: 0.65rem;
  color: var(--text-dimmer);
  margin-top: 12px;
  letter-spacing: 1px;
}

/* Scroll reveal */
.reveal {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}

.reveal.visible {
  opacity: 1;
  transform: translateY(0);
}

/* Mobile hamburger */
.hamburger {
  display: none;
  position: fixed;
  top: 12px;
  left: 12px;
  z-index: 200;
  background: var(--card-bg);
  border: 1px solid var(--border);
  color: var(--text);
  width: 48px;
  height: 48px;
  padding: 0;
  cursor: pointer;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 5px;
  border-radius: 6px;
  -webkit-tap-highlight-color: transparent;
  transition: background 0.2s ease;
}

.hamburger:active {
  background: var(--overlay-white);
}

.hamburger-bar {
  display: block;
  width: 22px;
  height: 2px;
  background: var(--text);
  border-radius: 1px;
  transition: transform 0.3s ease, opacity 0.3s ease;
}

.hamburger.active .hamburger-bar:nth-child(1) {
  transform: translateY(7px) rotate(45deg);
}

.hamburger.active .hamburger-bar:nth-child(2) {
  opacity: 0;
}

.hamburger.active .hamburger-bar:nth-child(3) {
  transform: translateY(-7px) rotate(-45deg);
}

/* Sidebar overlay */
.sidebar-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  z-index: 99;
  opacity: 0;
  transition: opacity 0.3s ease;
  -webkit-tap-highlight-color: transparent;
}

.sidebar-overlay.visible {
  display: block;
  opacity: 1;
}

/* Mobile theme switcher (shown in top bar when sidebar is collapsed) */
.mobile-theme-bar {
  display: none;
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 150;
  gap: 4px;
  align-items: center;
}

.mobile-theme-bar button {
  all: unset;
  cursor: pointer;
  font-family: 'Roboto Mono', monospace;
  font-size: 0.65rem;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--border);
  color: var(--text-dim);
  border-radius: 4px;
  -webkit-tap-highlight-color: transparent;
  transition: all 0.2s;
}

/* Responsive: Tablet / small desktop (900px) */
@media (max-width: 900px) {
  .sidebar {
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0; }
  .hamburger { display: flex; }
  .mobile-theme-bar { display: flex; }
  .section { padding: 60px 24px; }
  .hero { padding: 80px 24px 60px; padding-top: 80px; }
  .footer { padding: 32px 24px; }
  .card-grid.cols-3 { grid-template-columns: repeat(2, 1fr); }

  /* Architecture pipeline: force 2 cols on tablet */
  .section#architecture .card-grid[style*="repeat(4"] {
    grid-template-columns: repeat(2, 1fr) !important;
  }
}

/* Responsive: Mobile (600px) */
@media (max-width: 600px) {
  .hero { padding: 72px 16px 48px; }
  .hero h1 { font-size: 1.8rem; letter-spacing: -0.5px; }
  .hero-tagline { font-size: 0.85rem; word-break: break-word; }
  .hero-meta { flex-direction: column; gap: 8px; }
  .meta-badge { font-size: 0.7rem; padding: 6px 12px; min-height: 44px; display: flex; align-items: center; }

  .section { padding: 48px 16px; }
  .section-title { font-size: 1.3rem; }
  .section-desc { font-size: 0.8rem; margin-bottom: 28px; }

  /* Card grids: single column */
  .card-grid,
  .card-grid.cols-2,
  .card-grid.cols-3,
  .section#architecture .card-grid[style*="repeat(4"] {
    grid-template-columns: 1fr !important;
  }

  .card { padding: 20px; }
  .card h3 { font-size: 0.9rem; }
  .card .card-desc { font-size: 0.8rem; }

  .finding-card { padding: 20px; }
  .finding-card h4 { font-size: 0.85rem; }
  .finding-card p { font-size: 0.8rem; }

  .cat-card { padding: 16px; min-height: 44px; }

  .tech-grid { grid-template-columns: repeat(2, 1fr); }
  .tech-item { padding: 14px 10px; min-height: 44px; }

  /* CLI section: wrap and scroll */
  .cli-block { padding: 16px; }
  .cli-line { flex-wrap: wrap; font-size: 0.8rem; gap: 8px; }
  .cli-cmd { white-space: normal; word-break: break-all; }
  .cli-comment { margin-left: 0; font-size: 0.65rem; flex-basis: 100%; }

  /* Tables: horizontal scroll already handled by .results-table-wrap */
  .results-table { font-size: 0.75rem; }
  .results-table thead th { padding: 10px 12px; font-size: 0.65rem; }
  .results-table tbody td { padding: 10px 12px; }

  /* Footer: stack vertically */
  .footer { padding: 28px 16px; }
  .footer p { font-size: 0.65rem; }
  .footer .footer-stats { font-size: 0.6rem; }

  /* Sidebar nav touch targets */
  .sidebar-nav a { padding: 12px 12px; min-height: 44px; display: flex; align-items: center; }

  /* Sidebar footer touch targets */
  .sidebar-footer a { padding: 8px 4px; min-height: 44px; }

  /* Pre/code overflow protection */
  pre, code {
    overflow-x: auto;
    max-width: 100%;
    word-break: break-word;
  }
}

/* Responsive: Very small phones (480px) */
@media (max-width: 480px) {
  .hero { padding: 68px 12px 40px; }
  .hero h1 { font-size: 1.6rem; }
  .hero-tagline { font-size: 0.8rem; min-height: 1.4em; }
  .hero-badge { font-size: 0.6rem; padding: 5px 10px; }

  .section { padding: 40px 12px; }
  .section-label { font-size: 0.65rem; letter-spacing: 2px; }
  .section-title { font-size: 1.15rem; }
  .section-desc { font-size: 0.75rem; }

  .card { padding: 16px; }
  .card-icon { font-size: 1.2rem; margin-bottom: 8px; }
  .card h3 { font-size: 0.85rem; }
  .card .card-desc { font-size: 0.75rem; }

  .finding-card { padding: 16px; }
  .finding-card h4 { font-size: 0.8rem; }
  .finding-card p { font-size: 0.75rem; }

  .cat-card { padding: 14px; }
  .cat-card .cat-prefix { font-size: 0.6rem; }
  .cat-card h4 { font-size: 0.8rem; }

  .tech-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
  .tech-item { padding: 12px 8px; }
  .tech-item .tech-name { font-size: 0.8rem; }
  .tech-item .tech-role { font-size: 0.6rem; }

  .cli-block { padding: 12px; }
  .cli-line { font-size: 0.73rem; padding: 5px 0; }
  .cli-cmd { font-size: 0.73rem; }
  .cli-comment { font-size: 0.6rem; }

  .results-table { font-size: 0.7rem; }
  .results-table thead th { padding: 8px 10px; font-size: 0.6rem; letter-spacing: 1px; }
  .results-table tbody td { padding: 8px 10px; }

  .footer { padding: 24px 12px; }

  /* Mobile theme bar tighter */
  .mobile-theme-bar button { width: 32px; height: 32px; font-size: 0.6rem; }

  .hamburger { width: 44px; height: 44px; top: 10px; left: 10px; }
}

/* Responsive: Ultra-small screens (< 400px) */
@media (max-width: 400px) {
  .hero h1 { font-size: 1.4rem; }
  .hero-tagline { font-size: 0.73rem; }
  .section-title { font-size: 1.05rem; }
  .section-desc { font-size: 0.7rem; }
  .card h3 { font-size: 0.8rem; }
  .card .card-desc { font-size: 0.7rem; }
  .finding-card h4 { font-size: 0.75rem; }
  .finding-card p { font-size: 0.7rem; }
  .tech-item .tech-name { font-size: 0.73rem; }
  .cli-line { font-size: 0.68rem; }
  .cli-cmd { font-size: 0.68rem; }
  body { font-size: 0.9rem; }
}

/* ═══════════════════════════════════════════════
   BATCH 1: Reading Progress, Scroll-to-Top, Shortcuts
   ═══════════════════════════════════════════════ */

/* 1.1 Reading Progress Bar */
.reading-progress {
  position: fixed;
  top: 0;
  left: 0;
  height: 3px;
  width: 0%;
  background: linear-gradient(90deg, var(--neon-pink, #ff2d55), var(--neon-blue, #0ff));
  z-index: 10000;
  pointer-events: none;
  transition: none;
}

/* 1.2 Scroll-to-Top Button */
.scroll-top-btn {
  position: fixed;
  bottom: 32px;
  right: 32px;
  width: 44px;
  height: 44px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  color: var(--text);
  font-family: 'Roboto Mono', monospace;
  font-size: 1.2rem;
  font-weight: 700;
  cursor: pointer;
  z-index: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease, background 0.2s ease, border-color 0.2s ease;
}

.scroll-top-btn.visible {
  opacity: 1;
  pointer-events: auto;
}

.scroll-top-btn:hover {
  border-color: var(--neon-blue);
  color: var(--neon-blue);
  box-shadow: 0 0 12px rgba(0,255,255,0.15);
}

/* 1.3 Keyboard Shortcuts Help Overlay */
.shortcuts-overlay,
.cmd-palette-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 9000;
  display: none;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(4px);
}

.shortcuts-overlay.open,
.cmd-palette-overlay.open {
  display: flex;
}

.shortcuts-panel {
  background: var(--card-bg);
  border: 1px solid var(--border);
  padding: 32px 36px;
  max-width: 520px;
  width: 90%;
  max-height: 80vh;
  overflow-y: auto;
  font-family: 'Roboto Mono', monospace;
  position: relative;
}

.shortcuts-panel h2 {
  font-size: 1.1rem;
  font-weight: 700;
  margin-bottom: 4px;
  color: var(--text);
}

.shortcuts-panel .shortcuts-sub {
  font-size: 0.7rem;
  color: var(--text-dimmer);
  margin-bottom: 24px;
}

.shortcuts-panel .shortcuts-close {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: 1px solid var(--border);
  color: var(--text-dim);
  cursor: pointer;
  font-family: 'Roboto Mono', monospace;
  font-size: 0.7rem;
  padding: 4px 10px;
  transition: all 0.2s;
}

.shortcuts-panel .shortcuts-close:hover {
  border-color: var(--neon-pink);
  color: var(--neon-pink);
}

.shortcuts-group {
  margin-bottom: 20px;
}

.shortcuts-group-title {
  font-size: 0.65rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--neon-pink);
  margin-bottom: 10px;
}

.shortcut-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  font-size: 0.8rem;
  color: var(--text-dim);
}

.shortcut-row .shortcut-keys {
  display: flex;
  gap: 4px;
}

kbd {
  display: inline-block;
  font-family: 'Roboto Mono', monospace;
  font-size: 0.7rem;
  padding: 2px 8px;
  border: 1px solid var(--border);
  background: var(--overlay-white);
  color: var(--text);
  min-width: 24px;
  text-align: center;
  line-height: 1.6;
}

/* ═══════════════════════════════════════════════
   BATCH 2: Phase Bar, CTA, Sidebar Links
   ═══════════════════════════════════════════════ */

/* 2.3 Phase Bar */
.phase-bar {
  display: flex;
  gap: 8px;
  padding: 16px 60px;
  border-bottom: 1px solid var(--border-dim);
  background: var(--card-bg);
  flex-wrap: wrap;
  align-items: center;
}

.phase-pill {
  font-family: 'Roboto Mono', monospace;
  font-size: 0.7rem;
  padding: 6px 16px;
  text-decoration: none;
  letter-spacing: 1px;
  transition: all 0.2s ease;
  cursor: pointer;
  display: inline-block;
}

.phase-pill.active {
  background: var(--neon-blue);
  color: var(--bg);
  border: 1px solid var(--neon-blue);
  font-weight: 600;
}

.phase-pill.inactive {
  background: transparent;
  color: var(--text-dim);
  border: 1px solid var(--border);
}

.phase-pill.inactive:hover {
  border-color: var(--neon-blue);
  color: var(--neon-blue);
}

/* 2.4 Explore the Data CTA Section */
.cta-section {
  padding: 80px 60px;
  border-bottom: 1px solid var(--border-dim);
  text-align: center;
}

.cta-card {
  background: var(--card-bg);
  border: 1px solid var(--border-dim);
  padding: 48px 40px;
  max-width: 680px;
  margin: 0 auto;
}

.cta-card h2 {
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 8px;
}

.cta-card .cta-subtitle {
  font-size: 0.8rem;
  color: var(--text-dim);
  margin-bottom: 32px;
  line-height: 1.7;
}

.cta-buttons {
  display: flex;
  gap: 16px;
  justify-content: center;
  flex-wrap: wrap;
}

.cta-btn {
  font-family: 'Roboto Mono', monospace;
  font-size: 0.8rem;
  font-weight: 600;
  padding: 14px 28px;
  text-decoration: none;
  background: transparent;
  transition: all 0.25s ease;
  letter-spacing: 1px;
  display: inline-block;
}

.cta-btn.blue {
  border: 2px solid var(--neon-blue);
  color: var(--neon-blue);
}

.cta-btn.blue:hover {
  background: var(--neon-blue);
  color: var(--bg);
  box-shadow: 0 0 20px rgba(0,255,255,0.2);
}

.cta-btn.green {
  border: 2px solid var(--neon-green);
  color: var(--neon-green);
}

.cta-btn.green:hover {
  background: var(--neon-green);
  color: var(--bg);
  box-shadow: 0 0 20px rgba(0,255,0,0.2);
}

/* ═══════════════════════════════════════════════
   BATCH 3: Click-to-Copy CLI
   ═══════════════════════════════════════════════ */
.cli-line {
  cursor: pointer;
  position: relative;
}

.cli-copy-label {
  font-size: 0.6rem;
  color: var(--text-dimmer);
  margin-left: auto;
  opacity: 0;
  transition: opacity 0.2s;
  letter-spacing: 1px;
  white-space: nowrap;
  flex-shrink: 0;
}

.cli-line:hover .cli-copy-label {
  opacity: 1;
}

.cli-line:hover .cli-comment {
  display: none;
}

.cli-copy-label.copied {
  color: var(--neon-green);
  opacity: 1;
}

/* ═══════════════════════════════════════════════
   BATCH 4: Command Palette
   ═══════════════════════════════════════════════ */
.cmd-palette {
  background: var(--card-bg);
  border: 1px solid var(--border);
  width: 90%;
  max-width: 520px;
  max-height: 70vh;
  display: flex;
  flex-direction: column;
  font-family: 'Roboto Mono', monospace;
}

.cmd-palette-input {
  width: 100%;
  padding: 16px 20px;
  border: none;
  border-bottom: 1px solid var(--border);
  background: transparent;
  color: var(--text);
  font-family: 'Roboto Mono', monospace;
  font-size: 0.9rem;
  outline: none;
}

.cmd-palette-input::placeholder {
  color: var(--text-dimmer);
}

.cmd-palette-list {
  overflow-y: auto;
  max-height: 50vh;
  padding: 8px 0;
}

.cmd-palette-item {
  padding: 10px 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: background 0.15s;
  font-size: 0.8rem;
  color: var(--text-dim);
}

.cmd-palette-item:hover,
.cmd-palette-item.active {
  background: var(--overlay-white);
  color: var(--text);
}

.cmd-palette-item .cmd-cat {
  font-size: 0.6rem;
  color: var(--text-dimmer);
  letter-spacing: 1px;
  text-transform: uppercase;
  min-width: 64px;
  flex-shrink: 0;
}

.cmd-palette-item .cmd-name {
  flex: 1;
}

.cmd-palette-empty {
  padding: 20px;
  text-align: center;
  color: var(--text-dimmer);
  font-size: 0.8rem;
}

/* ═══════════════════════════════════════════════
   BATCH 5: Section Anchors, Table Sort, Counters, Active Nav
   ═══════════════════════════════════════════════ */

/* 5.1 Section Anchor Links */
.section-title {
  position: relative;
}

.section-anchor {
  position: absolute;
  left: -24px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-dimmer);
  text-decoration: none;
  font-size: 0.9rem;
  opacity: 0;
  transition: opacity 0.2s;
  cursor: pointer;
}

.section-title:hover .section-anchor {
  opacity: 1;
}

.section-anchor:hover {
  color: var(--neon-blue);
}

.anchor-copied {
  position: absolute;
  left: -24px;
  top: -20px;
  font-size: 0.6rem;
  color: var(--neon-green);
  letter-spacing: 1px;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.3s;
  pointer-events: none;
}

.anchor-copied.show {
  opacity: 1;
}

/* 5.2 Table Sorting */
.results-table thead th.sortable {
  cursor: pointer;
  user-select: none;
  position: relative;
  transition: color 0.2s;
}

.results-table thead th.sortable:hover {
  color: var(--neon-blue);
}

.sort-indicator {
  margin-left: 4px;
  font-size: 0.7rem;
  color: var(--neon-blue);
}

/* 5.4 Active Nav Highlighting */
.sidebar-nav a.nav-active {
  border-left: 2px solid var(--neon-blue);
  color: var(--text);
  background: var(--overlay-white);
  padding-left: 10px;
}

/* ═══════════════════════════════════════════════
   BATCH 6: Print Styles & Footer Hints
   ═══════════════════════════════════════════════ */

/* 6.1 Print Styles */
@media print {
  .sidebar,
  .hamburger,
  .sidebar-overlay,
  .mobile-theme-bar,
  .scroll-top-btn,
  .reading-progress,
  .shortcuts-overlay,
  .cmd-palette-overlay,
  .phase-bar,
  .theme-switcher {
    display: none !important;
  }

  .main {
    margin-left: 0 !important;
  }

  body, .main, .section, .hero, .footer {
    color: #000 !important;
    background: #fff !important;
  }

  .section-label,
  .section-title,
  .section-desc,
  .card h3,
  .card .card-desc,
  .finding-card h4,
  .finding-card p,
  .results-table,
  .results-table thead th,
  .results-table tbody td {
    color: #000 !important;
  }

  .card, .finding-card, .cat-card, .tech-item, .cli-block {
    background: #fff !important;
    border-color: #ccc !important;
    box-shadow: none !important;
  }

  a[href^="http"]::after {
    content: " (" attr(href) ")";
    font-size: 0.7rem;
    color: #666;
  }

  .section, .card, .finding-card, .cli-block, .results-table-wrap {
    page-break-inside: avoid;
  }

  body::after {
    display: none !important;
  }
}

/* 6.2 Footer shortcut hints */
.footer-hints {
  margin-top: 16px;
  font-size: 0.65rem;
  color: var(--text-dimmer);
}

.footer-hints kbd {
  font-size: 0.6rem;
  padding: 1px 6px;
  vertical-align: middle;
}

/* Responsive adjustments for new features */
@media (max-width: 900px) {
  .phase-bar { padding: 12px 24px; }
  .cta-section { padding: 60px 24px; }
  .section-anchor { left: -20px; font-size: 0.8rem; }
}

@media (max-width: 600px) {
  .phase-bar { padding: 10px 16px; gap: 6px; }
  .phase-pill { font-size: 0.6rem; padding: 5px 12px; }
  .cta-section { padding: 48px 16px; }
  .cta-card { padding: 32px 20px; }
  .cta-card h2 { font-size: 1.1rem; }
  .cta-btn { padding: 12px 20px; font-size: 0.7rem; }
  .shortcuts-panel { padding: 24px 20px; }
  .cmd-palette { max-height: 80vh; }
  .scroll-top-btn { bottom: 20px; right: 20px; width: 40px; height: 40px; font-size: 1rem; }
  .section-anchor { display: none; }
  .footer-hints { font-size: 0.6rem; }
}

/* ═══════════════════════════════════════════════
   CTA Purple Button
   ═══════════════════════════════════════════════ */
.cta-btn.purple {
  background: linear-gradient(135deg, #a855f7, #7c3aed);
  color: #fff;
}
.cta-btn.purple:hover {
  background: linear-gradient(135deg, #c084fc, #a855f7);
  transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(168, 85, 247, 0.4);
}

/* ═══════════════════════════════════════════════
   Welcome Toast
   ═══════════════════════════════════════════════ */
.welcome-toast {
  position: fixed;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  z-index: 9998;
  opacity: 0;
  transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.5s ease;
  pointer-events: none;
}
.welcome-toast.visible {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
  pointer-events: auto;
}
.welcome-toast.hiding {
  transform: translateX(-50%) translateY(100px);
  opacity: 0;
}
.welcome-content {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem 1.25rem;
  background: var(--bg-card);
  backdrop-filter: blur(12px);
  border: 1px solid var(--border);
  border-radius: 4px;
  font-family: var(--font-mono, 'JetBrains Mono', monospace);
  font-size: 0.85rem;
  color: var(--text-secondary, #aaa);
  box-shadow: 0 4px 24px rgba(0,0,0,0.3);
}
.welcome-content kbd {
  display: inline-block;
  padding: 2px 6px;
  background: rgba(255,255,255,0.1);
  border: 1px solid var(--border);
  border-radius: 3px;
  font-family: inherit;
  font-size: 0.8rem;
  color: var(--accent, var(--neon-blue, #0ff));
}
.welcome-dismiss {
  background: none;
  border: none;
  color: var(--text-secondary, #aaa);
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0 0.25rem;
  line-height: 1;
  opacity: 0.7;
  transition: opacity 0.2s;
}
.welcome-dismiss:hover {
  opacity: 1;
}
</style>
<script>
(function(){
  var t = localStorage.getItem('llm-theme');
  if (!t) t = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
  if (t !== 'dark') document.documentElement.setAttribute('data-theme', t);
})();
</script>
</head>
<body>
<div class="reading-progress" id="readingProgress"></div>

<!-- Scroll-to-Top Button -->
<button class="scroll-top-btn" id="scrollTopBtn" title="Scroll to top (Home)" aria-label="Scroll to top">&#8593;</button>

<!-- Keyboard Shortcuts Overlay -->
<div class="shortcuts-overlay" id="shortcutsOverlay">
  <div class="shortcuts-panel">
    <button class="shortcuts-close" onclick="closeShortcuts()">ESC</button>
    <h2>Keyboard Shortcuts</h2>
    <div class="shortcuts-sub">Navigate faster with your keyboard</div>

    <div class="shortcuts-group">
      <div class="shortcuts-group-title">General</div>
      <div class="shortcut-row"><span>Show this help</span><span class="shortcut-keys"><kbd>?</kbd></span></div>
      <div class="shortcut-row"><span>Command palette</span><span class="shortcut-keys"><kbd>&#8984;</kbd><kbd>K</kbd></span></div>
      <div class="shortcut-row"><span>Cycle theme</span><span class="shortcut-keys"><kbd>T</kbd></span></div>
      <div class="shortcut-row"><span>Close overlay</span><span class="shortcut-keys"><kbd>Esc</kbd></span></div>
    </div>

    <div class="shortcuts-group">
      <div class="shortcuts-group-title">Navigation</div>
      <div class="shortcut-row"><span>Scroll to top</span><span class="shortcut-keys"><kbd>Home</kbd> / <kbd>0</kbd></span></div>
      <div class="shortcut-row"><span>Go to section 1-7</span><span class="shortcut-keys"><kbd>1</kbd> &ndash; <kbd>7</kbd></span></div>
      <div class="shortcut-row"><span>Open GitHub repo</span><span class="shortcut-keys"><kbd>G</kbd></span></div>
    </div>

    <div class="shortcuts-group">
      <div class="shortcuts-group-title">Pages</div>
      <div class="shortcut-row"><span>Interactive Results</span><span class="shortcut-keys"><kbd>I</kbd></span></div>
      <div class="shortcut-row"><span>Hardware Guide</span><span class="shortcut-keys"><kbd>H</kbd></span></div>
      <div class="shortcut-row"><span>Mac Setup Kit</span><span class="shortcut-keys"><kbd>M</kbd></span></div>
    </div>
  </div>
</div>

<!-- Command Palette Overlay -->
<div class="cmd-palette-overlay" id="cmdPaletteOverlay">
  <div class="cmd-palette" id="cmdPalette">
    <input type="text" class="cmd-palette-input" id="cmdPaletteInput" placeholder="Type a command..." autocomplete="off" spellcheck="false">
    <div class="cmd-palette-list" id="cmdPaletteList"></div>
  </div>
</div>

<!-- Sidebar -->
<button class="hamburger" onclick="toggleSidebar()" aria-label="Toggle navigation">
  <span class="hamburger-bar"></span>
  <span class="hamburger-bar"></span>
  <span class="hamburger-bar"></span>
</button>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

<div class="mobile-theme-bar" id="mobileThemeBar">
  <button onclick="setTheme('dark')" title="Dark" data-theme-btn-m="dark">D</button>
  <button onclick="setTheme('light')" title="Light" data-theme-btn-m="light">L</button>
  <button onclick="setTheme('neon')" title="Neon" data-theme-btn-m="neon">N</button>
  <button onclick="setTheme('solarized')" title="Solarized" data-theme-btn-m="solarized">S</button>
</div>

<nav class="sidebar" id="sidebar">
  <div class="sidebar-logo">TPS<span class="accent">.</span>SH</div>
  <div class="sidebar-sub">tokens per second</div>

  <div class="sidebar-nav">
    <a href="#hero" onclick="closeSidebar()">Home</a>
    <a href="#results" onclick="closeSidebar()">Results</a>
    <a href="#architecture" onclick="closeSidebar()">Architecture</a>
    <a href="#categories" onclick="closeSidebar()">Prompt Categories</a>
    <a href="#findings" onclick="closeSidebar()">Key Findings</a>
    <a href="#cli" onclick="closeSidebar()">CLI Commands</a>
    <a href="#stack" onclick="closeSidebar()">Tech Stack</a>
  </div>

  <div class="sidebar-footer">
    <div class="theme-switcher" style="display:flex;gap:4px;margin-bottom:8px;">
      <button onclick="setTheme('dark')" title="Dark" style="all:unset;cursor:pointer;font-family:'Roboto Mono',monospace;font-size:0.65rem;padding:4px 8px;border:1px solid var(--border);color:var(--text-dim);border-radius:3px;transition:all 0.2s;" data-theme-btn="dark">D</button>
      <button onclick="setTheme('light')" title="Light" style="all:unset;cursor:pointer;font-family:'Roboto Mono',monospace;font-size:0.65rem;padding:4px 8px;border:1px solid var(--border);color:var(--text-dim);border-radius:3px;transition:all 0.2s;" data-theme-btn="light">L</button>
      <button onclick="setTheme('neon')" title="Neon" style="all:unset;cursor:pointer;font-family:'Roboto Mono',monospace;font-size:0.65rem;padding:4px 8px;border:1px solid var(--border);color:var(--text-dim);border-radius:3px;transition:all 0.2s;" data-theme-btn="neon">N</button>
      <button onclick="setTheme('solarized')" title="Solarized" style="all:unset;cursor:pointer;font-family:'Roboto Mono',monospace;font-size:0.65rem;padding:4px 8px;border:1px solid var(--border);color:var(--text-dim);border-radius:3px;transition:all 0.2s;" data-theme-btn="solarized">S</button>
    </div>
    <a href="https://github.com/parsamivehchi/tps.sh" target="_blank" rel="noopener">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 21.795 24 17.295 24 12 24 5.37 18.63 0 12 0z"/></svg>
      GitHub
    </a>
    <a href="comparison/index.html" target="_blank" rel="noopener">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h18v18H3z"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
      Interactive Results
    </a>
    <a href="comparison/hardware.html" target="_blank" rel="noopener">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="8" rx="2"/><rect x="2" y="14" width="20" height="8" rx="2"/><circle cx="6" cy="6" r="1" fill="currentColor"/><circle cx="6" cy="18" r="1" fill="currentColor"/></svg>
      Hardware Guide
    </a>
    <a href="https://parsamivehchi.github.io/LLM-Setup-Kit-for-Mac/" target="_blank" rel="noopener">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
      Mac Setup Kit
    </a>
  </div>
</nav>

<!-- Main -->
<div class="main">

  <!-- Hero -->
  <section class="hero" id="hero">
    <div class="hero-badge">
      <span class="status-dot"></span>
      147 TESTS COMPLETE
    </div>
    <h1>TPS<span class="accent">.</span>SH</h1>
    <div class="hero-tagline">
      <span id="typed"></span><span class="cursor"></span>
    </div>
    <div class="hero-meta">
      <div class="meta-badge green"><span class="val">7</span> Models</div>
      <div class="meta-badge blue"><span class="val">147</span> Tests</div>
      <div class="meta-badge pink"><span class="val">21</span> Prompts</div>
      <div class="meta-badge yellow"><span class="val">$3.95</span> Total Cost</div>
      <div class="meta-badge"><span class="val">M2 Max</span> Hardware</div>
    </div>
  </section>

  <!-- Phase Bar -->
  <div class="phase-bar">
    <span class="phase-pill active">Landing</span>
    <a href="comparison/index.html" class="phase-pill inactive">Interactive Results</a>
    <a href="comparison/hardware.html" class="phase-pill inactive">Hardware Guide</a>
    <a href="https://parsamivehchi.github.io/LLM-Setup-Kit-for-Mac/" target="_blank" class="phase-pill inactive">Setup Kit ↗</a>
  </div>

  <!-- Results -->
  <section class="section" id="results">
    <div class="section-label reveal">01 / RESULTS</div>
    <div class="section-title reveal">Benchmark Results</div>
    <div class="section-desc reveal">All 7 models compared across speed, quality, and cost. 4 local Ollama models vs 3 Claude API models on Apple M2 Max with 32GB unified memory.</div>

    <div class="results-table-wrap reveal">
      <table class="results-table">
        <thead>
          <tr>
            <th></th>
            <th>Model</th>
            <th>Type</th>
            <th>TPS</th>
            <th>TTFT</th>
            <th>Avg Time</th>
            <th>Quality</th>
            <th>Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="crown-icon">&#9889;</span></td>
            <td class="model-name" style="color:#06b6d4">Claude Haiku 4.5</td>
            <td>Cloud</td>
            <td class="best" style="color:#06b6d4"><span class="bar-inline" style="width:100%;background:#06b6d4"></span>169.7</td>
            <td class="best" style="color:#06b6d4">0.5s</td>
            <td style="color:#06b6d4">16.6s</td>
            <td><span class="quality-tag high">8.25</span></td>
            <td>$0.28</td>
          </tr>
          <tr>
            <td></td>
            <td class="model-name" style="color:#8b5cf6">Claude Sonnet 4.6</td>
            <td>Cloud</td>
            <td><span class="bar-inline" style="width:45%;background:#8b5cf6"></span>77.7</td>
            <td>1.0s</td>
            <td>39.9s</td>
            <td><span class="quality-tag high">8.59</span></td>
            <td>$0.93</td>
          </tr>
          <tr>
            <td><span class="crown-icon">&#127942;</span></td>
            <td class="model-name" style="color:#ec4899">Claude Opus 4.6</td>
            <td>Cloud</td>
            <td><span class="bar-inline" style="width:45%;background:#ec4899"></span>76.6</td>
            <td>1.8s</td>
            <td>40.4s</td>
            <td class="best"><span class="quality-tag high">8.65</span></td>
            <td>$1.48</td>
          </tr>
          <tr>
            <td><span class="crown-icon">&#128081;</span></td>
            <td class="model-name" style="color:#10b981">qwen3-coder</td>
            <td>Local</td>
            <td><span class="bar-inline" style="width:28%;background:#10b981"></span>48.8</td>
            <td>1.1s</td>
            <td>37.8s</td>
            <td><span class="quality-tag mid">7.48</span></td>
            <td style="color:var(--neon-green)">Free</td>
          </tr>
          <tr>
            <td></td>
            <td class="model-name" style="color:#3b82f6">qwen2.5-coder:14b</td>
            <td>Local</td>
            <td><span class="bar-inline" style="width:9%;background:#3b82f6"></span>15.6</td>
            <td>1.5s</td>
            <td>68.2s</td>
            <td><span class="quality-tag mid">6.64</span></td>
            <td style="color:var(--neon-green)">Free</td>
          </tr>
          <tr>
            <td></td>
            <td class="model-name" style="color:#f59e0b">deepseek-r1:14b</td>
            <td>Local</td>
            <td><span class="bar-inline" style="width:8%;background:#f59e0b"></span>14.6</td>
            <td>70.2s</td>
            <td>137.0s</td>
            <td><span class="quality-tag low">5.89</span></td>
            <td style="color:var(--neon-green)">Free</td>
          </tr>
          <tr>
            <td></td>
            <td class="model-name" style="color:#f43f5e">glm-4.7-flash</td>
            <td>Local</td>
            <td><span class="bar-inline" style="width:6%;background:#f43f5e"></span>10.2</td>
            <td>54.8s</td>
            <td>229.5s</td>
            <td><span class="quality-tag low">5.30</span></td>
            <td style="color:var(--neon-green)">Free</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card-grid cols-3 reveal" style="margin-top: 24px;">
      <div class="card" style="border-left: 2px solid var(--neon-blue);">
        <div class="card-icon" style="color:var(--neon-blue)">&#9889;</div>
        <h3>Fastest Model</h3>
        <div class="card-desc">Claude Haiku 4.5 at 169.7 tok/s &mdash; 3.5x faster than the best local model. Best value cloud option at $0.28.</div>
      </div>
      <div class="card" style="border-left: 2px solid var(--neon-pink);">
        <div class="card-icon" style="color:var(--neon-pink)">&#127942;</div>
        <h3>Highest Quality</h3>
        <div class="card-desc">Claude Opus 4.6 scores 8.65/10 &mdash; but Sonnet (8.59) nearly matches at 63% the cost. Diminishing returns at the top.</div>
      </div>
      <div class="card" style="border-left: 2px solid var(--neon-green);">
        <div class="card-icon" style="color:var(--neon-green)">&#128081;</div>
        <h3>Best Local</h3>
        <div class="card-desc">qwen3-coder at 48.8 tok/s with 7.48 quality. MoE architecture shines on M2 Max. 100% offline, zero cost, air-gapped.</div>
      </div>
    </div>
  </section>

  <!-- Architecture -->
  <section class="section" id="architecture">
    <div class="section-label reveal">02 / ARCHITECTURE</div>
    <div class="section-title reveal">Benchmark Pipeline</div>
    <div class="section-desc reveal">Four-stage pipeline: load prompts, execute against models, judge quality, generate reports.</div>

    <div class="card-grid" style="grid-template-columns: repeat(4, 1fr);" >
      <div class="card reveal">
        <div class="card-accent-top" style="background: var(--neon-pink);"></div>
        <div class="card-icon">&#128196;</div>
        <h3>Prompt Bank</h3>
        <div class="card-desc">21 YAML prompts across 7 coding categories. Each defines task, expected behavior, and evaluation criteria.</div>
        <div class="card-tag">21 prompts &middot; 7 categories</div>
      </div>
      <div class="card reveal">
        <div class="card-accent-top" style="background: var(--neon-blue);"></div>
        <div class="card-icon">&#9881;</div>
        <h3>Runner</h3>
        <div class="card-desc">Executes prompts against Ollama (local) and Anthropic API (cloud). Captures TPS, TTFT, tokens, cost, and hardware metrics.</div>
        <div class="card-tag">Ollama + Anthropic adapters</div>
      </div>
      <div class="card reveal">
        <div class="card-accent-top" style="background: var(--neon-green);"></div>
        <div class="card-icon">&#9878;</div>
        <h3>Judge</h3>
        <div class="card-desc">Claude Sonnet 4.6 scores each output on correctness (40%), completeness (35%), and clarity (25%). Bias-flagged for self-evaluation.</div>
        <div class="card-tag">weighted scoring &middot; bias flags</div>
      </div>
      <div class="card reveal">
        <div class="card-accent-top" style="background: var(--neon-yellow);"></div>
        <div class="card-icon">&#128202;</div>
        <h3>Reports</h3>
        <div class="card-desc">Word docs, PowerPoint decks, React dashboard, and interactive comparison website. Full export pipeline.</div>
        <div class="card-tag">docx + pptx + React + web</div>
      </div>
    </div>
  </section>

  <!-- Prompt Categories -->
  <section class="section" id="categories">
    <div class="section-label reveal">03 / PROMPT CATEGORIES</div>
    <div class="section-title reveal">7 Coding Task Types</div>
    <div class="section-desc reveal">Each category contains 3 prompts of varying complexity, testing different aspects of code intelligence.</div>

    <div class="card-grid reveal" style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
      <div class="cat-card">
        <div class="cat-prefix">$ cat code_generation.yaml</div>
        <h4>Code Generation</h4>
        <div class="cat-count">3 prompts &middot; Write new code from spec</div>
      </div>
      <div class="cat-card">
        <div class="cat-prefix">$ cat debugging_reasoning.yaml</div>
        <h4>Debugging & Reasoning</h4>
        <div class="cat-count">3 prompts &middot; Find and fix bugs</div>
      </div>
      <div class="cat-card">
        <div class="cat-prefix">$ cat refactoring.yaml</div>
        <h4>Refactoring</h4>
        <div class="cat-count">3 prompts &middot; Improve existing code</div>
      </div>
      <div class="cat-card">
        <div class="cat-prefix">$ cat explanation_teaching.yaml</div>
        <h4>Explanation & Teaching</h4>
        <div class="cat-count">3 prompts &middot; Explain concepts clearly</div>
      </div>
      <div class="cat-card">
        <div class="cat-prefix">$ cat short_quick.yaml</div>
        <h4>Short Quick Tasks</h4>
        <div class="cat-count">3 prompts &middot; Fast utility tasks</div>
      </div>
      <div class="cat-card">
        <div class="cat-prefix">$ cat long_complex.yaml</div>
        <h4>Long Complex Research</h4>
        <div class="cat-count">3 prompts &middot; Deep architecture tasks</div>
      </div>
      <div class="cat-card">
        <div class="cat-prefix">$ cat tool_calling.yaml</div>
        <h4>Tool Calling / Agentic</h4>
        <div class="cat-count">3 prompts &middot; Agentic tool use</div>
      </div>
    </div>
  </section>

  <!-- Key Findings -->
  <section class="section" id="findings">
    <div class="section-label reveal">04 / KEY FINDINGS</div>
    <div class="section-title reveal">What 147 Tests Reveal</div>
    <div class="section-desc reveal">The data tells a nuanced story about local vs cloud tradeoffs.</div>

    <div class="card-grid cols-2 reveal">
      <div class="finding-card">
        <h4>Cloud wins on quality, but diminishing returns at the top</h4>
        <p>All 3 Claude models score 8.25+. Opus (8.65) barely edges Sonnet (8.59), making Sonnet the smart buy at 63% the cost. The quality gap between best local (7.48) and worst cloud (8.25) is meaningful at scale.</p>
        <span class="finding-stat">+0.77 quality gap</span>
      </div>
      <div class="finding-card">
        <h4>MoE architecture dominates local inference</h4>
        <p>qwen3-coder (30B MoE) runs at 48.8 tok/s vs qwen2.5-coder (14B dense) at 15.6 tok/s &mdash; 3.1x faster despite being 2x larger. MoE activates fewer parameters per token, leveraging M2 Max memory bandwidth more efficiently.</p>
        <span class="finding-stat">3.1x speed advantage</span>
      </div>
      <div class="finding-card">
        <h4>Claude-judging-Claude bias caveat</h4>
        <p>62 of 147 quality scores involve Claude models judging Claude outputs. These are flagged in all reports but may inflate cloud scores. A fair comparison would need an independent judge (GPT-4 or human reviewers).</p>
        <span class="finding-stat">62/147 flagged</span>
      </div>
      <div class="finding-card">
        <h4>Total cost: $3.95 for the entire benchmark</h4>
        <p>Cloud benchmark run: $2.69. Quality judging via Sonnet: $1.26. That's 147 tests across 7 models including full quality scoring. Local models contribute zero to the bill.</p>
        <span class="finding-stat">$3.95 all-in</span>
      </div>
    </div>
  </section>

  <!-- CLI Commands -->
  <section class="section" id="cli">
    <div class="section-label reveal">05 / CLI</div>
    <div class="section-title reveal">Command-Line Interface</div>
    <div class="section-desc reveal">8 Typer commands for the full benchmark lifecycle. Run, judge, analyze, report, export.</div>

    <div class="cli-block reveal">
      <div class="cli-header">
        <span class="cli-dot red"></span>
        <span class="cli-dot yellow"></span>
        <span class="cli-dot green"></span>
        <span class="cli-title">llm-bench &mdash; terminal</span>
      </div>

      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench run</span>
        <span class="cli-comment"># Run benchmarks against all models</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench run --hardware-metrics</span>
        <span class="cli-comment"># With GPU/thermal capture</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench run -m qwen3-coder -c code_generation</span>
        <span class="cli-comment"># Filter by model and category</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench judge &lt;run_id&gt;</span>
        <span class="cli-comment"># Score outputs with Claude Sonnet</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench analyze &lt;run_id&gt;</span>
        <span class="cli-comment"># Generate analysis and rankings</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench report &lt;run_id&gt;</span>
        <span class="cli-comment"># Generate Word + PowerPoint reports</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench export &lt;run_id&gt;</span>
        <span class="cli-comment"># Export dashboard-ready JSON</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench hardware-report</span>
        <span class="cli-comment"># Generate hardware infrastructure guide</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench cost-estimate</span>
        <span class="cli-comment"># Estimate cost for a full run</span>
      </div>
      <div class="cli-line">
        <span class="cli-prompt">$</span>
        <span class="cli-cmd">python -m llm_bench list-runs</span>
        <span class="cli-comment"># List all benchmark runs</span>
      </div>
    </div>
  </section>

  <!-- Tech Stack -->
  <section class="section" id="stack">
    <div class="section-label reveal">06 / TECH STACK</div>
    <div class="section-title reveal">Built With</div>
    <div class="section-desc reveal">Python-first toolkit with React dashboard and interactive comparison websites.</div>

    <div class="tech-grid reveal">
      <div class="tech-item">
        <div class="tech-name" style="color:var(--neon-blue)">Python + Typer</div>
        <div class="tech-role">CLI framework</div>
      </div>
      <div class="tech-item">
        <div class="tech-name" style="color:var(--neon-green)">Ollama</div>
        <div class="tech-role">Local model runtime</div>
      </div>
      <div class="tech-item">
        <div class="tech-name" style="color:var(--neon-pink)">Anthropic API</div>
        <div class="tech-role">Cloud model access</div>
      </div>
      <div class="tech-item">
        <div class="tech-name" style="color:var(--neon-blue)">React + Recharts</div>
        <div class="tech-role">Dashboard UI</div>
      </div>
      <div class="tech-item">
        <div class="tech-name" style="color:var(--neon-yellow)">Chart.js</div>
        <div class="tech-role">Comparison website charts</div>
      </div>
      <div class="tech-item">
        <div class="tech-name" style="color:var(--neon-green)">python-docx</div>
        <div class="tech-role">Word report generation</div>
      </div>
      <div class="tech-item">
        <div class="tech-name" style="color:var(--neon-pink)">python-pptx</div>
        <div class="tech-role">PowerPoint generation</div>
      </div>
      <div class="tech-item">
        <div class="tech-name">Rich</div>
        <div class="tech-role">Terminal output</div>
      </div>
    </div>
  </section>

  <!-- Explore the Data CTA -->
  <section class="cta-section reveal">
    <div class="cta-card">
      <h2>Dive Into the Data</h2>
      <p class="cta-subtitle">Interactive Chart.js visualizations, hardware analysis, and the full comparison.</p>
      <div class="cta-buttons">
        <a href="comparison/index.html" class="cta-btn blue">INTERACTIVE RESULTS &rarr;</a>
        <a href="comparison/hardware.html" class="cta-btn green">HARDWARE GUIDE &rarr;</a>
        <a href="https://parsamivehchi.github.io/LLM-Setup-Kit-for-Mac/" target="_blank" class="cta-btn purple">MAC SETUP KIT ↗</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <p><a href="https://github.com/parsamivehchi/tps.sh">github.com/parsamivehchi/tps.sh</a></p>
    <p>tps.sh &middot; Built for Apple Silicon &middot; February 2026</p>
    <p><a href="comparison/index.html">Interactive Results</a> &middot; <a href="comparison/hardware.html">Hardware Guide</a> &middot; <a href="https://parsamivehchi.github.io/LLM-Setup-Kit-for-Mac/" target="_blank">Mac Setup Kit</a></p>
    <div class="footer-stats">7 models &middot; 147 tests &middot; 21 prompts &middot; 7 categories</div>
    <div class="footer-hints">Press <kbd>?</kbd> for keyboard shortcuts &middot; <kbd>&#8984;K</kbd> for command palette</div>
  </footer>

</div>

<script>
// Typing animation
const phrases = [
  'Tokens Per Second — LLM Benchmark',
  '7 models. 147 tests. One verdict.',
  'Ollama + Anthropic on Apple Silicon',
  'How fast is your local LLM, really?'
];
let phraseIndex = 0, charIndex = 0, deleting = false;
const typedEl = document.getElementById('typed');

function typeLoop() {
  const current = phrases[phraseIndex];
  if (!deleting) {
    typedEl.textContent = current.substring(0, charIndex + 1);
    charIndex++;
    if (charIndex === current.length) {
      setTimeout(() => { deleting = true; typeLoop(); }, 2000);
      return;
    }
    setTimeout(typeLoop, 50);
  } else {
    typedEl.textContent = current.substring(0, charIndex - 1);
    charIndex--;
    if (charIndex === 0) {
      deleting = false;
      phraseIndex = (phraseIndex + 1) % phrases.length;
      setTimeout(typeLoop, 400);
      return;
    }
    setTimeout(typeLoop, 30);
  }
}
typeLoop();

// Scroll reveal
const revealObserver = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) e.target.classList.add('visible');
  });
}, { threshold: 0.1 });
document.querySelectorAll('.reveal').forEach(el => revealObserver.observe(el));

// Sidebar toggle with overlay
function toggleSidebar() {
  var sidebar = document.getElementById('sidebar');
  var overlay = document.getElementById('sidebarOverlay');
  var hamburger = document.querySelector('.hamburger');
  var isOpen = sidebar.classList.contains('open');

  if (isOpen) {
    closeSidebar();
  } else {
    sidebar.classList.add('open');
    overlay.classList.add('visible');
    hamburger.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
}

// Close sidebar on mobile nav click
function closeSidebar() {
  if (window.innerWidth <= 900) {
    var sidebar = document.getElementById('sidebar');
    var overlay = document.getElementById('sidebarOverlay');
    var hamburger = document.querySelector('.hamburger');
    sidebar.classList.remove('open');
    overlay.classList.remove('visible');
    hamburger.classList.remove('active');
    document.body.style.overflow = '';
  }
}

// Close sidebar on resize to desktop
window.addEventListener('resize', function() {
  if (window.innerWidth > 900) {
    var overlay = document.getElementById('sidebarOverlay');
    var hamburger = document.querySelector('.hamburger');
    overlay.classList.remove('visible');
    hamburger.classList.remove('active');
    document.body.style.overflow = '';
  }
});

// Theme switching
const themeList = ['dark', 'light', 'neon', 'solarized'];

function setTheme(theme) {
  if (theme === 'dark') {
    document.documentElement.removeAttribute('data-theme');
  } else {
    document.documentElement.setAttribute('data-theme', theme);
  }
  localStorage.setItem('llm-theme', theme);
  updateThemeButtons(theme);
}

function cycleTheme() {
  var current = localStorage.getItem('llm-theme') || 'dark';
  var idx = themeList.indexOf(current);
  var next = themeList[(idx + 1) % themeList.length];
  setTheme(next);
}

function updateThemeButtons(active) {
  // Sidebar theme buttons
  document.querySelectorAll('[data-theme-btn]').forEach(function(btn) {
    var isActive = btn.getAttribute('data-theme-btn') === active;
    btn.style.background = isActive ? 'var(--neon-blue)' : 'transparent';
    btn.style.color = isActive ? 'var(--bg)' : 'var(--text-dim)';
    btn.style.borderColor = isActive ? 'var(--neon-blue)' : 'var(--border)';
  });
  // Mobile theme bar buttons
  document.querySelectorAll('[data-theme-btn-m]').forEach(function(btn) {
    var isActive = btn.getAttribute('data-theme-btn-m') === active;
    btn.style.background = isActive ? 'var(--neon-blue)' : 'transparent';
    btn.style.color = isActive ? 'var(--bg)' : 'var(--text-dim)';
    btn.style.borderColor = isActive ? 'var(--neon-blue)' : 'var(--border)';
  });
}

// Initialize theme buttons
(function() {
  var t = localStorage.getItem('llm-theme') || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
  updateThemeButtons(t);
})();

// ═══════════════════════════════════════════════
// BATCH 1: Reading Progress, Scroll-to-Top, Shortcuts
// ═══════════════════════════════════════════════

// 1.1 Reading Progress Bar
var readingProgress = document.getElementById('readingProgress');
window.addEventListener('scroll', function() {
  var scrollTop = window.scrollY;
  var docHeight = document.documentElement.scrollHeight - window.innerHeight;
  var progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
  readingProgress.style.width = progress + '%';
}, { passive: true });

// 1.2 Scroll-to-Top Button
var scrollTopBtn = document.getElementById('scrollTopBtn');
window.addEventListener('scroll', function() {
  if (window.scrollY > 400) {
    scrollTopBtn.classList.add('visible');
  } else {
    scrollTopBtn.classList.remove('visible');
  }
}, { passive: true });

scrollTopBtn.addEventListener('click', function() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

// 1.3 Keyboard Shortcuts & Help Overlay
function closeShortcuts() {
  document.getElementById('shortcutsOverlay').classList.remove('open');
}

function toggleShortcuts() {
  var overlay = document.getElementById('shortcutsOverlay');
  overlay.classList.toggle('open');
}

function closeAllOverlays() {
  document.getElementById('shortcutsOverlay').classList.remove('open');
  closeCmdPalette();
  closeSidebar();
}

// Section map for keyboard navigation
var sectionIds = ['hero', 'results', 'architecture', 'categories', 'findings', 'cli', 'stack'];

document.addEventListener('keydown', function(e) {
  // Guard: ignore when focus is in input/textarea/select
  var tag = document.activeElement.tagName.toLowerCase();
  var isInput = (tag === 'input' || tag === 'textarea' || tag === 'select');

  // Command palette: Cmd+K / Ctrl+K (always works)
  if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
    e.preventDefault();
    toggleCmdPalette();
    return;
  }

  // Escape: close overlays (always works)
  if (e.key === 'Escape') {
    closeAllOverlays();
    return;
  }

  // Everything below is guarded from inputs
  if (isInput) return;

  // ? to toggle shortcuts help
  if (e.key === '?') {
    e.preventDefault();
    toggleShortcuts();
    return;
  }

  // t to cycle theme
  if (e.key === 't' || e.key === 'T') {
    e.preventDefault();
    cycleTheme();
    return;
  }

  // g to open GitHub
  if (e.key === 'g' || e.key === 'G') {
    e.preventDefault();
    window.open('https://github.com/parsamivehchi/tps.sh', '_blank');
    return;
  }

  // Home or 0 to scroll to top
  if (e.key === 'Home' || e.key === '0') {
    e.preventDefault();
    window.scrollTo({ top: 0, behavior: 'smooth' });
    return;
  }

  // 1-7 to jump to sections
  var num = parseInt(e.key);
  if (num >= 1 && num <= 7) {
    e.preventDefault();
    var targetId = sectionIds[num - 1];
    var target = document.getElementById(targetId);
    if (target) target.scrollIntoView({ behavior: 'smooth' });
    return;
  }

  // i to navigate to Interactive Results
  if (e.key === 'i' || e.key === 'I') {
    e.preventDefault();
    window.location.href = 'comparison/index.html';
    return;
  }

  // h to navigate to Hardware Guide
  if (e.key === 'h' || e.key === 'H') {
    e.preventDefault();
    window.location.href = 'comparison/hardware.html';
    return;
  }

  // m to open Mac Setup Kit
  if (e.key === 'm' || e.key === 'M') {
    e.preventDefault();
    window.open('https://parsamivehchi.github.io/LLM-Setup-Kit-for-Mac/', '_blank');
    return;
  }
});

// ═══════════════════════════════════════════════
// BATCH 3: Click-to-Copy CLI Commands
// ═══════════════════════════════════════════════

document.querySelectorAll('.cli-line').forEach(function(line) {
  // Add copy label
  var label = document.createElement('span');
  label.className = 'cli-copy-label';
  label.textContent = 'CLICK TO COPY';
  line.appendChild(label);

  line.addEventListener('click', function() {
    var cmd = line.querySelector('.cli-cmd');
    if (!cmd) return;
    navigator.clipboard.writeText(cmd.textContent).then(function() {
      label.textContent = 'COPIED!';
      label.classList.add('copied');
      setTimeout(function() {
        label.textContent = 'CLICK TO COPY';
        label.classList.remove('copied');
      }, 1500);
    });
  });
});

// ═══════════════════════════════════════════════
// BATCH 4: Command Palette
// ═══════════════════════════════════════════════

var cmdPaletteActive = -1;

// Build command list
var sectionNames = ['Home', 'Results', 'Architecture', 'Prompt Categories', 'Key Findings', 'CLI Commands', 'Tech Stack'];
var commands = [];

// Section jumps
sectionIds.forEach(function(id, i) {
  commands.push({
    cat: 'NAV',
    name: 'Go to ' + sectionNames[i],
    action: function() {
      var el = document.getElementById(id);
      if (el) el.scrollIntoView({ behavior: 'smooth' });
    }
  });
});

// Theme switches
themeList.forEach(function(t) {
  commands.push({
    cat: 'THEME',
    name: 'Theme: ' + t.charAt(0).toUpperCase() + t.slice(1),
    action: function() { setTheme(t); }
  });
});

// Page navigation
commands.push({
  cat: 'PAGE',
  name: 'Go to Interactive Results',
  action: function() { window.location.href = 'comparison/index.html'; }
});
commands.push({
  cat: 'PAGE',
  name: 'Go to Hardware Guide',
  action: function() { window.location.href = 'comparison/hardware.html'; }
});
commands.push({
  cat: 'PAGE',
  name: 'Open Mac Setup Kit',
  action: function() { window.open('https://parsamivehchi.github.io/LLM-Setup-Kit-for-Mac/', '_blank'); }
});

// Actions
commands.push({
  cat: 'ACTION',
  name: 'Open GitHub Repository',
  action: function() { window.open('https://github.com/parsamivehchi/tps.sh', '_blank'); }
});
commands.push({
  cat: 'ACTION',
  name: 'Show Keyboard Shortcuts',
  action: function() { toggleShortcuts(); }
});

var cmdPaletteListEl = document.getElementById('cmdPaletteList');
var cmdPaletteInputEl = document.getElementById('cmdPaletteInput');

function openCmdPalette() {
  document.getElementById('cmdPaletteOverlay').classList.add('open');
  cmdPaletteInputEl.value = '';
  cmdPaletteActive = -1;
  renderCmdPalette('');
  setTimeout(function() { cmdPaletteInputEl.focus(); }, 50);
}

function closeCmdPalette() {
  document.getElementById('cmdPaletteOverlay').classList.remove('open');
  cmdPaletteInputEl.blur();
}

function toggleCmdPalette() {
  var overlay = document.getElementById('cmdPaletteOverlay');
  if (overlay.classList.contains('open')) {
    closeCmdPalette();
  } else {
    openCmdPalette();
  }
}

function renderCmdPalette(query) {
  var filtered = commands.filter(function(cmd) {
    return cmd.name.toLowerCase().includes(query.toLowerCase());
  });

  cmdPaletteListEl.innerHTML = '';

  if (filtered.length === 0) {
    var empty = document.createElement('div');
    empty.className = 'cmd-palette-empty';
    empty.textContent = 'No matching commands';
    cmdPaletteListEl.appendChild(empty);
    return;
  }

  filtered.forEach(function(cmd, i) {
    var item = document.createElement('div');
    item.className = 'cmd-palette-item' + (i === cmdPaletteActive ? ' active' : '');
    item.innerHTML = '<span class="cmd-cat">' + cmd.cat + '</span><span class="cmd-name">' + cmd.name + '</span>';
    item.addEventListener('click', function() {
      closeCmdPalette();
      cmd.action();
    });
    item.addEventListener('mouseenter', function() {
      cmdPaletteActive = i;
      updateCmdPaletteHighlight();
    });
    cmdPaletteListEl.appendChild(item);
  });
}

function updateCmdPaletteHighlight() {
  var items = cmdPaletteListEl.querySelectorAll('.cmd-palette-item');
  items.forEach(function(item, i) {
    item.classList.toggle('active', i === cmdPaletteActive);
  });
  // Scroll active into view
  if (cmdPaletteActive >= 0 && items[cmdPaletteActive]) {
    items[cmdPaletteActive].scrollIntoView({ block: 'nearest' });
  }
}

function getFilteredCommands() {
  var query = cmdPaletteInputEl.value;
  return commands.filter(function(cmd) {
    return cmd.name.toLowerCase().includes(query.toLowerCase());
  });
}

cmdPaletteInputEl.addEventListener('input', function() {
  cmdPaletteActive = -1;
  renderCmdPalette(this.value);
});

cmdPaletteInputEl.addEventListener('keydown', function(e) {
  var filtered = getFilteredCommands();
  if (e.key === 'ArrowDown') {
    e.preventDefault();
    cmdPaletteActive = Math.min(cmdPaletteActive + 1, filtered.length - 1);
    updateCmdPaletteHighlight();
  } else if (e.key === 'ArrowUp') {
    e.preventDefault();
    cmdPaletteActive = Math.max(cmdPaletteActive - 1, 0);
    updateCmdPaletteHighlight();
  } else if (e.key === 'Enter') {
    e.preventDefault();
    if (cmdPaletteActive >= 0 && cmdPaletteActive < filtered.length) {
      closeCmdPalette();
      filtered[cmdPaletteActive].action();
    }
  }
});

// Close palette on overlay click
document.getElementById('cmdPaletteOverlay').addEventListener('click', function(e) {
  if (e.target === this) closeCmdPalette();
});

// Close shortcuts on overlay click
document.getElementById('shortcutsOverlay').addEventListener('click', function(e) {
  if (e.target === this) closeShortcuts();
});

// ═══════════════════════════════════════════════
// BATCH 5: Section Anchors, Table Sort, Counters, Active Nav
// ═══════════════════════════════════════════════

// 5.1 Section Anchor Links
document.querySelectorAll('.section-title').forEach(function(title) {
  var section = title.closest('.section') || title.closest('.hero');
  if (!section || !section.id) return;

  var anchor = document.createElement('a');
  anchor.className = 'section-anchor';
  anchor.textContent = '#';
  anchor.href = '#' + section.id;
  anchor.title = 'Copy link to section';

  var feedback = document.createElement('span');
  feedback.className = 'anchor-copied';
  feedback.textContent = 'Link copied!';

  title.style.position = 'relative';
  title.insertBefore(feedback, title.firstChild);
  title.insertBefore(anchor, title.firstChild);

  anchor.addEventListener('click', function(e) {
    e.preventDefault();
    var url = window.location.origin + window.location.pathname + '#' + section.id;
    navigator.clipboard.writeText(url).then(function() {
      history.replaceState(null, '', '#' + section.id);
      feedback.classList.add('show');
      setTimeout(function() { feedback.classList.remove('show'); }, 1500);
    });
  });
});

// 5.2 Table Sorting
(function() {
  var table = document.querySelector('.results-table');
  if (!table) return;
  var thead = table.querySelector('thead');
  var tbody = table.querySelector('tbody');
  var headers = thead.querySelectorAll('th');

  // Column definitions: index -> { type: 'string'|'number', key }
  var sortableColumns = {
    1: { type: 'string', name: 'Model' },
    2: { type: 'string', name: 'Type' },
    3: { type: 'number', name: 'TPS' },
    4: { type: 'number', name: 'TTFT' },
    5: { type: 'number', name: 'Avg Time' },
    6: { type: 'number', name: 'Quality' },
    7: { type: 'number', name: 'Cost' }
  };

  var currentSort = { col: -1, asc: true };

  headers.forEach(function(th, idx) {
    if (sortableColumns[idx]) {
      th.classList.add('sortable');
      th.addEventListener('click', function() {
        var asc = (currentSort.col === idx) ? !currentSort.asc : true;
        currentSort = { col: idx, asc: asc };
        sortTable(idx, asc, sortableColumns[idx].type);
        updateSortIndicators(idx, asc);
      });
    }
  });

  function parseNumeric(text) {
    // Extract numeric value: strip $, s, Free -> 0, etc.
    var clean = text.replace(/[^0-9.\-]/g, '');
    if (text.toLowerCase().includes('free')) return 0;
    var val = parseFloat(clean);
    return isNaN(val) ? 0 : val;
  }

  function sortTable(colIdx, asc, type) {
    var rows = Array.from(tbody.querySelectorAll('tr'));
    rows.sort(function(a, b) {
      var cellA = a.querySelectorAll('td')[colIdx];
      var cellB = b.querySelectorAll('td')[colIdx];
      if (!cellA || !cellB) return 0;

      if (type === 'number') {
        var valA = parseNumeric(cellA.textContent);
        var valB = parseNumeric(cellB.textContent);
        return asc ? valA - valB : valB - valA;
      } else {
        var strA = cellA.textContent.trim().toLowerCase();
        var strB = cellB.textContent.trim().toLowerCase();
        return asc ? strA.localeCompare(strB) : strB.localeCompare(strA);
      }
    });
    rows.forEach(function(row) { tbody.appendChild(row); });
  }

  function updateSortIndicators(activeIdx, asc) {
    headers.forEach(function(th, idx) {
      // Remove existing indicator
      var existing = th.querySelector('.sort-indicator');
      if (existing) existing.remove();

      if (idx === activeIdx && sortableColumns[idx]) {
        var span = document.createElement('span');
        span.className = 'sort-indicator';
        span.textContent = asc ? '\u25B4' : '\u25BE';
        th.appendChild(span);
      }
    });
  }
})();

// 5.3 Animated Counters
(function() {
  var badges = document.querySelectorAll('.meta-badge .val');
  if (!badges.length) return;

  var animated = false;

  function animateCounter(el, target, duration) {
    var isFloat = target.toString().includes('.');
    var prefix = '';
    var suffix = '';

    // Detect $ prefix
    var text = el.textContent.trim();
    if (text.startsWith('$')) prefix = '$';

    // Don't animate non-numeric values (like "M2 Max")
    var numVal = parseFloat(target);
    if (isNaN(numVal)) return;

    var decimals = isFloat ? (target.toString().split('.')[1] || '').length : 0;
    var startTime = null;

    function step(timestamp) {
      if (!startTime) startTime = timestamp;
      var progress = Math.min((timestamp - startTime) / duration, 1);
      // Cubic ease-out
      var eased = 1 - Math.pow(1 - progress, 3);
      var current = numVal * eased;

      if (decimals > 0) {
        el.textContent = prefix + current.toFixed(decimals);
      } else {
        el.textContent = prefix + Math.round(current);
      }

      if (progress < 1) {
        requestAnimationFrame(step);
      } else {
        el.textContent = text; // Restore exact original text
      }
    }

    el.textContent = prefix + (decimals > 0 ? (0).toFixed(decimals) : '0');
    requestAnimationFrame(step);
  }

  var counterObserver = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (entry.isIntersecting && !animated) {
        animated = true;
        badges.forEach(function(badge) {
          var text = badge.textContent.trim();
          var numStr = text.replace(/[^0-9.]/g, '');
          var numVal = parseFloat(numStr);
          if (!isNaN(numVal)) {
            animateCounter(badge, numStr, 1200);
          }
        });
        counterObserver.disconnect();
      }
    });
  }, { threshold: 0.3 });

  var heroMeta = document.querySelector('.hero-meta');
  if (heroMeta) counterObserver.observe(heroMeta);
})();

// 5.4 Active Nav Highlighting
(function() {
  var navLinks = document.querySelectorAll('.sidebar-nav a');
  var sections = [];

  navLinks.forEach(function(link) {
    var href = link.getAttribute('href');
    if (href && href.startsWith('#')) {
      var section = document.getElementById(href.slice(1));
      if (section) sections.push({ el: section, link: link });
    }
  });

  function updateActiveNav() {
    var scrollPos = window.scrollY + 200;
    var activeLink = null;

    for (var i = sections.length - 1; i >= 0; i--) {
      if (sections[i].el.offsetTop <= scrollPos) {
        activeLink = sections[i].link;
        break;
      }
    }

    navLinks.forEach(function(link) { link.classList.remove('nav-active'); });
    if (activeLink) activeLink.classList.add('nav-active');
  }

  window.addEventListener('scroll', updateActiveNav, { passive: true });
  updateActiveNav();
})();

// Welcome toast - first visit only
(function() {
  var WELCOME_KEY = 'tps-welcome-seen';
  if (!localStorage.getItem(WELCOME_KEY)) {
    var toast = document.getElementById('welcomeToast');
    if (toast) {
      setTimeout(function() { toast.classList.add('visible'); }, 1500);
      localStorage.setItem(WELCOME_KEY, '1');
      var dismiss = function() {
        toast.classList.remove('visible');
        toast.classList.add('hiding');
      };
      document.getElementById('welcomeDismiss').addEventListener('click', dismiss);
      setTimeout(dismiss, 9500);
    }
  }
})();
</script>

<div class="welcome-toast" id="welcomeToast">
  <div class="welcome-content">
    <span class="welcome-text">
      <kbd>?</kbd> shortcuts &nbsp;&middot;&nbsp; <kbd>&#8984;K</kbd> command palette &nbsp;&middot;&nbsp; <kbd>T</kbd> change theme
    </span>
    <button class="welcome-dismiss" id="welcomeDismiss" aria-label="Dismiss">&times;</button>
  </div>
</div>

</body>
</html>
